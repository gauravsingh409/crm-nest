datasource db {
  provider = "postgresql"
}

generator client {
  provider = "prisma-client-js"
}

// User Model
enum Role {
  SUPER_ADMIN
  ADMIN
  MANAGER
  BRANCH_MANAGER
  CONTACT_AGENT
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  password  String
  role      Role
  isActive  Boolean  @default(true)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  leads          Lead[]         @relation("LeadOwner")
  leadActivities LeadActivity[] @relation("ActivityPerformer")
  // Relationships
  profile        UserProfile?

  @@map("users")
}

model UserProfile {
  id        String   @id @default(cuid())
  firstName String
  lastName  String
  phone     String?
  profile   String?
  userId    String   @unique
  user      User     @relation(fields: [userId], references: [id], onDelete: Cascade)
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@map("user_profiles")
}

// Leads Model
enum LeadSource {
  WHATSAPP
  FACEBOOK
  INSTAGRAM
  YOUTUBE
  WEBSITE
  TIKTOK
  DOCTOR_REFERRAL
  SELF_CONTACT
  ADVERTISEMENT
  FRIENDS_FAMILY
  EXISTING_PATIENT
  TV
  RADIO
  OTHER
}

enum LeadCategory {
  FERTILITY_PATIENT
  NOT_FERTILITY_PATIENT
  SPAM_TEST_LEAD
  GYANEA_PATIENT
}

enum LeadService {
  IVF
  IUI
  EGG_FREEZING
  EMBRYO_FREEZING
  DONOR_PROGRAM_EGG
  DONOR_PROGRAM_SPERM
  PGT_PGD
  TESA_PESA
  ANTENATAL_CHECKUP
  INFERTILITY_DIAGNOSIS_GENERAL_COUNSELLING
  GYANEA
  FERTILITY_PRESERVATION
}

enum LeadStatus {
  NEW
  CONTACTED
  QUALIFIED
  DISQUALIFIED
  CONVERTED
}

model Lead {
  id             String         @id @default(cuid())
  firstName      String
  lastName       String
  phone          String
  email          String?
  whatsapp       String?
  categories     LeadCategory
  service        LeadService
  source         LeadSource
  status         LeadStatus     @default(NEW)
  ownerId        String?
  owner          User?          @relation("LeadOwner", fields: [ownerId], references: [id])
  address        String?
  dob            DateTime?
  createdAt      DateTime       @default(now())
  updatedAt      DateTime       @updatedAt
  description    String?
  leadActivities LeadActivity[]

  @@index([source])
  @@index([categories])
  @@index([service])
  @@index([status])
  @@index([ownerId])
  @@map("leads")
}

// Lead Activities

enum ActivityType {
  CALL
}

enum CallOutcome {
  SUCCESS
  BUSY
  NO_RESPONSE
  FAILED
  WRONG_NUMBER
  RECEIVED_BY_FAMILY
}

model LeadActivity {
  id            String       @id @default(uuid())
  leadId        String
  type          ActivityType
  callOutcome   CallOutcome?
  durationSec   Int?
  notes         String?
  performedById String
  performedBy   User         @relation("ActivityPerformer", fields: [performedById], references: [id])
  lead          Lead         @relation(fields: [leadId], references: [id], onDelete: Cascade)
  createdAt     DateTime     @default(now())

  @@index([leadId])
  @@index([type])
  @@index([callOutcome])
  @@index([performedById])
}
